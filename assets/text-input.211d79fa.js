var l=Object.defineProperty;var x=(e,t,s)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var n=(e,t,s)=>(x(e,typeof t!="symbol"?t+"":t,s),s);import{u as f,b as r}from"./route-block.2e3b92a2.js";import{d,E as B,F as y,J as k}from"./app.9f30afb5.js";function a(e){return e.replace(/\n/g,"<br>").replace(/ /g,"&nbsp;")}function c(e,t,s=!1){e.html(""),e.position(t.position().x,t.position().y),["font-size","line-height"].forEach(h=>{e.style(h,t.style(h))}),e.size(t.size().width),e.style("word-break","break-all");const i=t.elt.selectionStart||0,o=t.elt.value,p=a(o.substring(0,i)),u=a(o.substring(i,o.length));e.html(`${p}${s?'<span id="__track__">0</span>':""}${u}`)}function g(e,t,s){t.show(),c(t,s,!0);let i={x:0,y:0};return Array.from(t.child()).forEach(o=>{o.nodeType===1&&o.id==="__track__"&&(i=o.getBoundingClientRect())},{}),s.size(t.size().width,t.size().height),t.hide(),i}class m{constructor(t,s,i){n(this,"sk");n(this,"isActive");n(this,"cursor");n(this,"position");n(this,"inputBox");n(this,"textStyle");n(this,"text");n(this,"isFocus");n(this,"canvasPosition");n(this,"tempInputBox");this.sk=t,this.isActive=!1,this.isFocus=!1,this.textStyle={size:20,color:t.color(0)},this.tempInputBox=t.createDiv(),this.inputBox=t.createElement("textarea"),this.inputBox.style("opacity","0"),this.inputBox.style("resize","both"),this.inputBox.elt.addEventListener("input",()=>{this.setInput(this.inputBox.value())}),this.inputBox.elt.addEventListener("keyup",()=>{this.getCursorPosition()}),this.inputBox.elt.addEventListener("click",()=>{this.getCursorPosition()}),this.inputBox.elt.addEventListener("focus",()=>{this.isFocus=!0}),Object.assign(this.textStyle,i),this.inputBox.style("font-size",`${this.textStyle.size}px`),this.inputBox.style("background","transparent"),this.inputBox.style("color","red"),this.inputBox.style("line-height","1"),this.setInput(""),this.tempInputBox.style("min-height",`${this.inputBox.size().height}px`),this.canvasPosition=s}get boxSize(){const t=this.inputBox.size();return[t.width,t.height]}setInput(t){t.split(/\n/g);let s=0;this.tempInputBox.show(),c(this.tempInputBox,this.inputBox),this.text=Array.from(this.tempInputBox.elt.childNodes).map(i=>(i.nodeName==="BR"&&s++,i.nodeType===3?{offsetTop:s,data:i.textContent}:null)).filter(Boolean),this.tempInputBox.hide()}canvas2Window(t){return[t[0]+this.canvasPosition.x,t[1]+this.canvasPosition.y]}window2Canvas(t){return[t[0]-this.canvasPosition.x,t[1]-this.canvasPosition.y]}active(){this.isActive=!0}getCursorPosition(){const t=g(this.sk,this.tempInputBox,this.inputBox);this.cursor=this.window2Canvas([t.x,t.y])}drawBox(){if(this.position){const t=this.position.map(o=>o-2),s=this.boxSize.map(o=>o+2);this.sk.rect(...t,...s);const i=[this.position[0]+this.boxSize[0],this.position[1]+this.boxSize[1]];[5,9].forEach(o=>{this.sk.line(i[0]-o,i[1],i[0],i[1]-o)})}}drawText(){this.text&&this.position&&(this.sk.noStroke(),this.sk.fill(this.textStyle.color),this.sk.textLeading(this.textStyle.size),this.sk.textSize(this.textStyle.size),this.sk.textAlign(this.sk.LEFT,this.sk.TOP),this.sk.textWrap(this.sk.CHAR),this.text.forEach(t=>{this.sk.text(t.data,this.position[0],this.position[1]+this.textStyle.size*t.offsetTop,this.boxSize[0])}))}draw(){this.isActive&&(this.sk.cursor(this.sk.TEXT),this.cursor&&(this.sk.stroke(this.textStyle.color),this.sk.strokeWeight(1),this.sk.noFill(),this.drawBox(),this.sk.line(...this.cursor,this.cursor[0],this.cursor[1]+this.textStyle.size),this.drawText()))}handleClick(){this.isFocus||(this.cursor=[this.sk.mouseX,this.sk.mouseY],this.position=[...this.cursor],this.inputBox.elt.focus(),this.inputBox.position(...this.canvas2Window(this.cursor)))}}const z={class:"p-5 h-full"},w=d({__name:"text-input",setup(e){const{el:t}=f(s=>{let i;s.setup=()=>{const o=s.createCanvas(500,500);i=new m(s,o.position()),i.active()},s.draw=()=>{s.clear(0,0,0,0),s.background(255),i.draw()},s.mouseClicked=()=>{i.handleClick()}});return(s,i)=>(k(),B("div",z,[y("div",{ref_key:"el",ref:t,class:"w-full h-full"},null,512)]))}});typeof r=="function"&&r(w);export{w as default};
